services:
  database:
    name: "Database Service"
    description: "SQLite database service for the application"
    triggeredBy:
      - postDevcontainerStart
    commands:
      start: |
        cd /workspaces/flex-demo/services/database
        npm install
        # Create database directory if it doesn't exist
        mkdir -p data
        npm start

  backend:
    name: "Backend API"
    description: "Node.js backend service"
    triggeredBy:
      - postDevcontainerStart
    commands:
      start: |
        cd /workspaces/flex-demo/services/backend
        npm install
        npm start

  management-ui:
    name: "Management UI"
    description: "Development environment visualization dashboard"
    triggeredBy:
      - postEnvironmentStart
    commands:
      start: |
        cd /workspaces/flex-demo/management-ui
        npm install
        npm run dev

  gitpod-flix:
    name: "Gitpod Flix"
    description: "Streaming platform frontend"
    triggeredBy:
      - postEnvironmentStart
    commands:
      start: |
        cd /workspaces/flex-demo/frontend
        npm install
        npm run dev

tasks:
  installDependencies:
    name: "Install Dependencies"
    description: "Install all project dependencies"
    triggeredBy:
      - postDevcontainerStart
    command: |
      echo "Installing management UI dependencies..."
      cd /workspaces/flex-demo/management-ui && npm install
      echo "Installing Gitpod Flix dependencies..."
      cd /workspaces/flex-demo/frontend && npm install
      echo "Installing backend dependencies..."
      cd /workspaces/flex-demo/services/backend && npm install
      echo "Installing database service dependencies..."
      cd /workspaces/flex-demo/services/database && npm install

  # setupDatabase:
  #   name: "Setup Database"
  #   description: "Initialize database schema and seed data"
  #   triggeredBy:
  #     - postDevcontainerStart
  #   dependsOn:
  #     - installDependencies
  #   command: |
  #     echo "Setting up database..."
  #     cd /workspaces/flex-demo/services/database
  #     # Create database directory if it doesn't exist
  #     mkdir -p data
  #     # Run the setup script
  #     node setup.js

  runTests:
    name: "Run Tests"
    description: "Run all test suites"
    triggeredBy:
      - manual
    command: |
      echo "Running management UI tests..."
      cd /workspaces/flex-demo/management-ui && npm test
      echo "Running Gitpod Flix tests..."
      cd /workspaces/flex-demo/frontend && npm test
      echo "Running backend tests..."
      cd /workspaces/flex-demo/services/backend && npm test

  # lint:
  #   name: "Run Linters"
  #   description: "Run all linters"
  #   triggeredBy:
  #     - manual
  #   command: |
  #     echo "Linting frontend..."
  #     cd /workspaces/flex-demo/frontend && npm run lint
  #     echo "Linting backend..."
  #     cd /workspaces/flex-demo/services/backend && npm run lint
  #     echo "Linting database service..."
  #     cd /workspaces/flex-demo/services/database && npm run lint

  # build:
  #   name: "Build All"
  #   description: "Build all services"
  #   triggeredBy:
  #     - manual
  #   command: |
  #     echo "Building frontend..."
  #     cd /workspaces/flex-demo/frontend && npm run build
  #     echo "Building backend..."
  #     cd /workspaces/flex-demo/services/backend && npm run build
  #     echo "Building database service..."
  #     cd /workspaces/flex-demo/services/database && npm run build
